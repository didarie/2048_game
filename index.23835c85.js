let t,e,s;class i{static get STATUS(){return{idle:"idle",playing:"playing",win:"win",lose:"lose"}}static get INITIAL_STATE(){return[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}constructor(t=i.INITIAL_STATE){this.status=i.STATUS.idle,this.initialState=t,this.state=this.initialState.map(t=>t.slice()),this.score=0,this.moves=0,this.animation={newCell:[]}}moveLeft(){let t=this.move("left");t&&(this.state=t,this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(t)||this.lose())}moveRight(){let t=this.move("right");t&&(this.state=t,this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(t)||this.lose())}moveUp(){let t=this.getGridData(),e=this.move("up",t);e&&(this.state=this.getGridData(e),this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(e)||this.lose())}moveDown(){let t=this.getGridData(),e=this.move("down",t);e&&(this.state=this.getGridData(e),this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(e)||this.lose())}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=i.STATUS.playing,this.getRandomCell(),this.getRandomCell()}restart(){this.status=i.STATUS.idle,this.score=0,this.state=this.initialState.map(t=>t.slice())}lose(){this.status=i.STATUS.lose}win(){this.status=i.STATUS.win}move(t,e=this.state){if("playing"!==this.status)return!1;let s=[];for(let i=0;i<e.length;i++){let a=e[i].filter(t=>t);for(a.length>1&&(a=this.mergeCells(a,t));a.length<4;)"left"===t||"up"===t?a.push(0):a.unshift(0);s.push(a)}return JSON.stringify(e)!==JSON.stringify(s)&&s}hasAvailableMoves(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)if(0===t[e][s]||e<t.length-1&&t[e][s]===t[e+1][s]||s<t[e].length-1&&t[e][s]===t[e][s+1])return!0;return!1}getRandomCell(){for(;;){let t=Math.floor(Math.random()*(this.state.length*this.state[0].length)),e=Math.floor(t/this.state[0].length),s=t%this.state[0].length,i=Math.random()>.1?2:4;if(this.isEmpty(this.state[e][s]))return this.state[e][s]=i,[e,s,i]}}getGridData(t=this.state){let e=[];for(let s=0;s<t.length;s++)e.push(t.map(t=>t[s]));return e}isEmpty(t){return 0===t}mergeCells(t,e){let s=t,i=[],a=0;for(("right"===e||"down"===e)&&(s=[...s].reverse());a<s.length;)if(0!==s[a]&&s[a]===s[a+1]){let t=2*s[a];this.score+=t,i.push(t),2048===t&&this.win(),a+=2}else i.push(s[a]),a++;return"right"===e||"down"===e?i.reverse():i}}const a=new i,l=document.querySelector("button"),n=document.querySelector(".game-field"),o=document.querySelector(".message-start"),r=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),c=document.querySelector(".game-score"),d=[...n.rows].map(t=>t.cells);function m(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)!function(t,e){let s=d[t[0]][t[1]],i=s.classList,l=[...i].findIndex(t=>t.startsWith("field-cell--"),0);-1!==l&&s.classList.remove(i[l]),[...i].includes("new")&&s.classList.remove("new"),e?((0===a.animation.newCell.length||t.every((t,e)=>t===a.animation.newCell[e]))&&s.classList.add("new"),s.classList.add(`field-cell--${t[2]}`),s.textContent=`${t[2]}`):(s.classList.remove(i[l]),s.textContent="")}([e,s,t[e][s]],0!==t[e][s]),c.textContent=a.score,"win"===a.status&&r.classList.remove("hidden"),"lose"===a.status&&h.classList.remove("hidden")}l.addEventListener("click",t=>{[...t.target.classList].includes("start")?(a.start(),m(a.state),o.classList.add("hidden"),l.classList.remove("start"),l.classList.add("restart"),l.textContent="Restart"):(a.restart(),c.textContent=0,function(){for(let t of d)[...t].forEach(t=>{2===t.classList.length&&(t.classList.remove(t.classList[1]),t.classList.remove(t.classList[1]),t.textContent="")})}(),h.classList.add("hidden"),r.classList.add("hidden"),o.classList.remove("hidden"),l.classList.remove("restart"),l.classList.add("start"),l.textContent="Start")}),document.addEventListener("keydown",t=>{if("playing"===a.status)switch(t.code){case"ArrowLeft":a.moveLeft(),m(a.state);break;case"ArrowRight":a.moveRight(),m(a.state);break;case"ArrowUp":a.moveUp(),m(a.state);break;case"ArrowDown":a.moveDown(),m(a.state)}}),n.addEventListener("touchstart",function(s){t=s.touches[0].clientX,e=s.touches[0].clientY},{passive:!0}),n.addEventListener("touchmove",function(i){let a=i.touches[0].clientX,l=i.touches[0].clientY,n=a-t,o=l-e;s=Math.abs(n)>Math.abs(o)?n>0?"right":"left":o>0?"down":"up"},{passive:!0}),n.addEventListener("touchend",function(t){if("playing"===a.status)switch(s){case"left":a.moveLeft(),m(a.state);break;case"right":a.moveRight(),m(a.state);break;case"up":a.moveUp(),m(a.state);break;case"down":a.moveDown(),m(a.state)}},{passive:!0});
//# sourceMappingURL=index.23835c85.js.map
