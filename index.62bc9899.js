!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=Array(e);n<e;n++)s[n]=t[n];return s}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,void 0);var s=Object.prototype.toString.call(e).slice(8,-1);if("Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var s,i,a,r=new/*#__PURE__*/(function(){var t,s;function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.INITIAL_STATE;!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,i),this.status=i.STATUS.idle,this.initialState=t,this.state=this.initialState.map(function(t){return t.slice()}),this.score=0,this.moves=0,this.animation={newCell:[]}}return s=[{key:"STATUS",get:function(){return{idle:"idle",playing:"playing",win:"win",lose:"lose"}}},{key:"INITIAL_STATE",get:function(){return[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}}],t=[{key:"moveLeft",value:function(){var t=this.move("left");t&&(this.state=t,this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(t)||this.lose())}},{key:"moveRight",value:function(){var t=this.move("right");t&&(this.state=t,this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(t)||this.lose())}},{key:"moveUp",value:function(){var t=this.getGridData(),e=this.move("up",t);e&&(this.state=this.getGridData(e),this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(e)||this.lose())}},{key:"moveDown",value:function(){var t=this.getGridData(),e=this.move("down",t);e&&(this.state=this.getGridData(e),this.animation.newCell=this.getRandomCell(),this.hasAvailableMoves(e)||this.lose())}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status=i.STATUS.playing,this.getRandomCell(),this.getRandomCell()}},{key:"restart",value:function(){this.status=i.STATUS.idle,this.score=0,this.state=this.initialState.map(function(t){return t.slice()})}},{key:"lose",value:function(){this.status=i.STATUS.lose}},{key:"win",value:function(){this.status=i.STATUS.win}},{key:"move",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state;if("playing"!==this.status)return!1;for(var s=[],i=0;i<n.length;i++)!function(i){var a=n[i].filter(function(t){return t});for(a.length>1&&(a=e.mergeCells(a,t));a.length<4;)"left"===t||"up"===t?a.push(0):a.unshift(0);s.push(a)}(i);return JSON.stringify(n)!==JSON.stringify(s)&&s}},{key:"hasAvailableMoves",value:function(t){for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)if(0===t[e][n]||e<t.length-1&&t[e][n]===t[e+1][n]||n<t[e].length-1&&t[e][n]===t[e][n+1])return!0;return!1}},{key:"getRandomCell",value:function(){for(;;){var t=Math.floor(Math.random()*(this.state.length*this.state[0].length)),e=Math.floor(t/this.state[0].length),n=t%this.state[0].length,s=Math.random()>.1?2:4;if(this.isEmpty(this.state[e][n]))return this.state[e][n]=s,[e,n,s]}}},{key:"getGridData",value:function(){for(var t=function(t){n.push(e.map(function(e){return e[t]}))},e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,n=[],s=0;s<e.length;s++)t(s);return n}},{key:"isEmpty",value:function(t){return 0===t}},{key:"mergeCells",value:function(t,n){var s=t,i=[],a=0;for(("right"===n||"down"===n)&&(s=e(s).reverse());a<s.length;)if(0!==s[a]&&s[a]===s[a+1]){var r=2*s[a];this.score+=r,i.push(r),2048===r&&this.win(),a+=2}else i.push(s[a]),a++;return"right"===n||"down"===n?i.reverse():i}}],n(i.prototype,t),s&&n(i,s),i}()),o=document.querySelector("button"),l=document.querySelector(".game-field"),u=document.querySelector(".message-start"),c=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),f=document.querySelector(".game-score"),v=e(l.rows).map(function(t){return t.cells});function d(t){for(var n=0;n<t.length;n++)for(var s=0;s<t[n].length;s++)!function(t,n){var s=v[t[0]][t[1]],i=s.classList,a=e(i).findIndex(function(t){return t.startsWith("field-cell--")},0);-1!==a&&s.classList.remove(i[a]),e(i).includes("new")&&s.classList.remove("new"),n?((0===r.animation.newCell.length||t.every(function(t,e){return t===r.animation.newCell[e]}))&&s.classList.add("new"),s.classList.add("field-cell--".concat(t[2])),s.textContent="".concat(t[2])):(s.classList.remove(i[a]),s.textContent="")}([n,s,t[n][s]],0!==t[n][s]),f.textContent=r.score,"win"===r.status&&c.classList.remove("hidden"),"lose"===r.status&&h.classList.remove("hidden")}o.addEventListener("click",function(t){e(t.target.classList).includes("start")?(r.start(),d(r.state),u.classList.add("hidden"),o.classList.remove("start"),o.classList.add("restart"),o.textContent="Restart"):(r.restart(),f.textContent=0,function(){var t=!0,n=!1,s=void 0;try{for(var i,a=v[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var r=i.value;e(r).forEach(function(t){2===t.classList.length&&(t.classList.remove(t.classList[1]),t.classList.remove(t.classList[1]),t.textContent="")})}}catch(t){n=!0,s=t}finally{try{t||null==a.return||a.return()}finally{if(n)throw s}}}(),h.classList.add("hidden"),c.classList.add("hidden"),u.classList.remove("hidden"),o.classList.remove("restart"),o.classList.add("start"),o.textContent="Start")}),document.addEventListener("keydown",function(t){if("playing"===r.status)switch(t.code){case"ArrowLeft":r.moveLeft(),d(r.state);break;case"ArrowRight":r.moveRight(),d(r.state);break;case"ArrowUp":r.moveUp(),d(r.state);break;case"ArrowDown":r.moveDown(),d(r.state)}}),l.addEventListener("touchstart",function(t){s=t.touches[0].clientX,i=t.touches[0].clientY},{passive:!0}),l.addEventListener("touchmove",function(t){var e=t.touches[0].clientX,n=t.touches[0].clientY,r=e-s,o=n-i;a=Math.abs(r)>Math.abs(o)?r>0?"right":"left":o>0?"down":"up"},{passive:!0}),l.addEventListener("touchend",function(t){if("playing"===r.status)switch(a){case"left":r.moveLeft(),d(r.state);break;case"right":r.moveRight(),d(r.state);break;case"up":r.moveUp(),d(r.state);break;case"down":r.moveDown(),d(r.state)}},{passive:!0})}();
//# sourceMappingURL=index.62bc9899.js.map
